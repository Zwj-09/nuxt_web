<script setup lang="ts">
import ToggleSwitch from 'primevue/toggleswitch';

const theme = ref(true);

interface DocType extends Document {
  startViewTransition: (callback?: unknown) => any;
}

const handleChange = (event: any) => {
  const switchDOM = document.getElementById('toggleSwitch');
  const transition = (document as DocType).startViewTransition(() => {
    if (!theme.value) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  });

  transition.ready.then((res: any) => {
    const clientX = switchDOM?.getBoundingClientRect().left || 0;
    const clientY = switchDOM?.getBoundingClientRect().top || 0;

    // 半径
    const radius = Math.hypot(
      Math.max(clientX, window.innerWidth - clientX),
      Math.max(clientY, window.innerHeight - clientY)
    );

    const isDark = document.documentElement.classList.contains('dark');

    const clipPath = [
      `circle(0px at ${clientX}px ${clientY}px)`,
      `circle(${radius}px at ${clientX}px ${clientY}px)`,
    ];

    document.documentElement.animate(
      {
        clipPath: isDark ? clipPath.reverse() : clipPath,
      },
      {
        duration: 500,
        pseudoElement: isDark ? '::view-transition-old(root)' : '::view-transition-new(root)',
      }
    );
  });
};

const getSvgTotalLength = () => {
  const svgDOM = document.getElementById('svg');
  if (svgDOM) {
    const paths = svgDOM.querySelectorAll('path');
    console.log('paths', paths);

    paths.forEach((path) => {
      if (path) {
        const len = path.getTotalLength();
        console.log(
          '%c len:',
          'background-color: #3756d4; padding: 4px; border-radius: 2px; font-size: 14px; color: #fff; font-weight: 700;',
          typeof len
        );
        path.style.setProperty('--l', String(len));
      }
    });
  }
};

onMounted(() => {
  getSvgTotalLength();
});
</script>

<template>
  <header>
    <div>
      <svg
        id="svg"
        t="1733922730739"
        class="icon"
        viewBox="0 0 1213 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="6971"
        width="200"
        height="200"
      >
        <path
          d="M82.933863 132.782076s50.859014 22.151139 86.300836 10.986965 113.059411-37.568331 126.350095-31.011594 6.556737 46.605996-8.860456 75.313871-82.047817 137.337059-106.325465 146.197515-90.908273 55.466451-113.059412 51.036223-31.011594 19.84742-15.417192 28.707876 68.579925-4.430228 97.46501-19.84742 75.313871-33.315312 68.579925-15.594402-99.591519 148.501233-135.033341 179.512828-48.732505 37.568331-44.302277 57.59296 15.417192 0 59.719469-22.151139 188.373283-115.185921 201.663966-90.908272-15.594402 252.52298-201.663966 440.896262c0 0-70.883644 10.986965-95.161291-259.256926 0 0-11.164174 159.488198 8.860455 214.954649a918.474811 918.474811 0 0 0 53.162733 115.185921 120.324985 120.324985 0 0 0 31.011594-44.302277c17.720911-35.441822 115.185921-93.034782 219.207668-354.418218 0 0 17.720911-39.872049 39.872049-42.175768a88.604554 88.604554 0 0 0 19.315793-26.581366c3.012555-7.265573-20.733466 0-75.313871-67.871089 0 0-26.581366-19.138584-159.488198 57.59296 0 0-7.797201-17.720911 38.454376-45.71995 31.011594-19.315793 78.149217-146.197515 126.881722-155.05797 0 0 32.606476-11.87301 32.606476-35.441822s-37.036704-8.860455-51.745059-4.430227a27.644621 27.644621 0 0 0-17.720911-7.442783c-10.278128 0 25.163693-35.441822 34.024149-51.74506s44.125068-79.744099 69.288761-84.174326 41.466931-5.847901 41.466932-19.138584-75.313871-69.465971-109.33802-65.035743-119.616148 70.883644-220.80255 64.326906zM553.246838 86.176081a373.379592 373.379592 0 0 0 119.616148-7.265574c57.59296-14.885565 159.488198-26.581366 161.08308-59.187842s-38.454377-19.138584-90.199436 0-153.463088 57.415751-190.499792 66.453416zM495.653877 55.164487a306.394549 306.394549 0 0 1 32.606476 104.907792c1.417673 45.71995 38.277168 178.626782 17.720911 181.639337s-48.732505 34.024149-19.315793 60.605515a635.826282 635.826282 0 0 0 78.326427 60.428306c8.860455 4.430228 44.302277 13.290683 34.024148-5.847901s-37.036704-44.302277-41.466931-65.035742-36.859495-85.592-39.87205-168.348654 7.442783-124.046376-62.023188-168.348653z"
          p-id="6972"
        ></path>
        <path
          d="M582.840759 236.626614a77.794799 77.794799 0 0 0 45.71995-1.417673c19.315793-8.860455 53.162733 20.733466-14.708356 75.313872s-13.290683 42.884604 22.151139 38.454376-5.847901 23.568811-38.454377 42.707395l-13.290683 13.290684a556.79102 556.79102 0 0 1 88.604554-55.998079c20.733466-8.860455 121.033821-41.466931 119.616149-62.023188a224.523941 224.523941 0 0 1-22.151139-10.455337c-7.265573-4.430228-48.732505 4.430228-78.149217 23.74602s-59.187842 60.428306-101.895238 45.71995c0 0-8.860455-8.860455 44.302278-41.289722s94.452455-97.46501 165.336098-118.198476c0 0 11.87301-23.568811-17.720911-23.568811a327.128015 327.128015 0 0 0-119.616148 33.84694c-34.024149 17.89812-59.010633 41.644141-79.744099 39.872049zM351.051245 546.919764a453.123691 453.123691 0 0 0 67.871088 6.025109c20.733466-1.594882 66.453416-45.897159 169.766327-69.46597 0 0-23.568811 20.733466-44.302278 41.289722s-69.288762 51.74506-72.301316 118.198476a788.226116 788.226116 0 0 0 22.151139 191.917465c10.278128 44.302277 31.011594 137.337059 31.011594 141.767287s32.606476 48.732505 44.302277 47.314832c25.163693-3.012555 25.163693-14.708356 48.732505-60.605516s60.605515-138.754732 101.895237-188.90491a1432.558436 1432.558436 0 0 0-119.616148 138.754733c-31.011594 47.314832-50.150178 60.605515-59.010633 53.162732s-22.328348-26.581366-32.606476-141.767287-17.720911-225.941614-4.430228-246.675079a426.187907 426.187907 0 0 1 96.047337-88.604555c72.832944-34.024149 208.043494-85.592 284.952247-93.034782 0 0 20.733466 1.594882 19.315793-13.290683s-39.872049-10.278128-56.175288-13.290683-87.186882 20.733466-128.476604 38.454377a1518.150435 1518.150435 0 0 1-187.487237 72.301316c-84.174327 25.163693-181.639337 66.453416-181.639336 66.453416z"
          p-id="6973"
        ></path>
        <path
          d="M525.247799 625.24619a571.322167 571.322167 0 0 0 65.035742-20.733466c19.138584-8.860455 32.429267 10.455337 45.719951 26.581366s147.615188 193.512347 225.941613 243.662525 85.592 41.466931 153.640298 39.87205 168.171444 8.860455 197.765365 4.430227a292.749448 292.749448 0 0 0-106.325465-27.999039c-53.162733-1.417673-181.639337-4.430228-227.359287-26.581366S698.02668 708.002844 672.862986 659.270339s-44.302277-87.186882-60.428306-84.174327a84.351536 84.351536 0 0 0-45.897159 29.416712c-10.278128 13.290683-20.556257 11.87301-41.289722 20.733466z"
          p-id="6974"
        ></path>
        <path
          d="M801.33959 458.315209s5.847901 19.315793-39.872049 59.187843-141.767287 124.046376-237.637415 159.488198a673.394614 673.394614 0 0 0 169.766326-73.896199c70.883644-47.314832 101.895238-84.174327 122.628703-82.756654s42.707395-13.290683 42.707395-26.581366-20.556257 3.012555-32.429266-14.708356a46.783205 46.783205 0 0 0-25.163694-20.733466z"
          p-id="6975"
        ></path>
      </svg>
    </div>
    <ToggleSwitch id="toggleSwitch" v-model="theme" @change="handleChange" />
  </header>
  <div class="space"></div>
</template>

<style lang="scss" scoped>
header {
  width: 100%;
  height: $headerHeight;
  // position: fixed;
  top: 0;
  left: 0;
  z-index: 999;
}

.space {
  height: $headerHeight;
}

svg {
  width: 300px;
  height: 60px;
  overflow: visible;
  border: 1px dashed tomato;

  path {
    fill: none;
    stroke: red; // 设置颜色
    stroke-width: 3; // 设置高度

    //如果为奇数个数的话 会自动补全 例如输入 10,20,30 会补全为 10,20,30,10,20,30 为一个循环
    stroke-dasharray: var(--l); //分割成虚实的线 可以设置多个(实线长度，虚线长度。。。。)

    // 虚线移动距离 正数 往左移动 负数 往右移动
    stroke-dashoffset: var(--l);
    animation: lineMove 5s linear 2s 1;
  }
}

@keyframes lineMove {
  0% {
    stroke-dashoffset: var(--l);
  }
  100% {
    stroke-dashoffset: 0;
  }
}
</style>
